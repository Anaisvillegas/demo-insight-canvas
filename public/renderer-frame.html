<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Artifact Renderer Frame</title>
  
  <!-- React 18 (versi√≥n exacta del proyecto) -->
  <script src="https://unpkg.com/react@18.3.1/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18.3.1/umd/react-dom.development.js"></script>
  
  <!-- Babel Standalone para transpilaci√≥n JSX -->
  <script src="https://unpkg.com/@babel/standalone@7.24.7/babel.min.js"></script>
  
  <!-- PropTypes para Recharts -->
  <script src="https://unpkg.com/prop-types@15.8.1/prop-types.min.js"></script>
  
  <!-- Recharts para gr√°ficos (desde node_modules + fallbacks CDN) -->
  <script>
    // Cargar Recharts desde node_modules primero, luego fallbacks CDN
    (function() {
      const rechartsUrls = [
        '/recharts.js',  // Desde public (local)
        'https://unpkg.com/recharts@2.8.0/umd/Recharts.js',
        'https://cdn.jsdelivr.net/npm/recharts@2.8.0/umd/Recharts.js',
        'https://unpkg.com/recharts@2.5.0/umd/Recharts.js',
        'https://cdn.jsdelivr.net/npm/recharts@2.5.0/umd/Recharts.js'
      ];
      
      let currentIndex = 0;
      
      function loadRecharts() {
        if (currentIndex >= rechartsUrls.length) {
          console.error('No se pudo cargar Recharts desde ninguna fuente');
          return;
        }
        
        const script = document.createElement('script');
        script.src = rechartsUrls[currentIndex];
        script.onload = function() {
          console.log('‚úÖ Recharts cargado exitosamente desde:', rechartsUrls[currentIndex]);
          console.log('üéØ window.Recharts disponible:', !!window.Recharts);
          if (window.Recharts) {
            console.log('üìä Componentes Recharts:', Object.keys(window.Recharts).slice(0, 10));
          }
        };
        script.onerror = function() {
          console.warn('‚ö†Ô∏è Fall√≥ cargar Recharts desde:', rechartsUrls[currentIndex]);
          currentIndex++;
          loadRecharts();
        };
        document.head.appendChild(script);
      }
      
      loadRecharts();
    })();
  </script>
  
  <!-- Tailwind CSS (CDN para desarrollo - en producci√≥n usar PostCSS) -->
  <script src="https://cdn.tailwindcss.com/3.4.1"></script>
  
  <!-- Configuraci√≥n de Tailwind para coincidir con el proyecto -->
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            border: 'hsl(214.3 31.8% 91.4%)',
            input: 'hsl(214.3 31.8% 91.4%)',
            ring: 'hsl(220 85% 47%)',
            background: 'hsl(0 0% 100%)',
            foreground: 'hsl(222.2 84% 4.9%)',
            primary: {
              DEFAULT: 'hsl(220 85% 47%)',
              foreground: 'hsl(0 0% 100%)',
            },
            secondary: {
              DEFAULT: 'hsl(220 14% 35%)',
              foreground: 'hsl(0 0% 100%)',
            },
            destructive: {
              DEFAULT: 'hsl(0 84.2% 60.2%)',
              foreground: 'hsl(210 40% 98%)',
            },
            muted: {
              DEFAULT: 'hsl(210 40% 96.1%)',
              foreground: 'hsl(215.4 16.3% 46.9%)',
            },
            accent: {
              DEFAULT: 'hsl(270 76% 60%)',
              foreground: 'hsl(0 0% 100%)',
            },
            popover: {
              DEFAULT: 'hsl(0 0% 100%)',
              foreground: 'hsl(222.2 84% 4.9%)',
            },
            card: {
              DEFAULT: 'hsl(0 0% 100%)',
              foreground: 'hsl(222.2 84% 4.9%)',
            },
          },
          borderRadius: {
            lg: '0.5rem',
            md: 'calc(0.5rem - 2px)',
            sm: 'calc(0.5rem - 4px)',
          },
          fontFamily: {
            sans: ['-apple-system', 'BlinkMacSystemFont', 'Segoe UI', 'Roboto', 'sans-serif'],
          },
        },
      },
    }
  </script>
  
  <style>
    /* Estilos base del proyecto */
    * {
      border-color: hsl(214.3 31.8% 91.4%);
    }
    
    body {
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
      background-color: hsl(0 0% 100%);
      color: hsl(222.2 84% 4.9%);
      line-height: 1.5;
    }
    
    #root {
      width: 100vw;
      height: 100vh;
      overflow: auto;
    }
    
    .loading {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      color: hsl(215.4 16.3% 46.9%);
      font-size: 14px;
    }
    
    .error-container {
      padding: 16px;
      margin: 16px;
      background-color: hsl(0 84.2% 60.2% / 0.1);
      border: 1px solid hsl(0 84.2% 60.2% / 0.2);
      border-radius: 6px;
      color: hsl(0 84.2% 60.2%);
      font-family: 'Courier New', monospace;
      font-size: 14px;
    }
    
    .markdown-content {
      padding: 16px;
      max-width: 100%;
      overflow-wrap: break-word;
    }
    
    .markdown-content h1,
    .markdown-content h2,
    .markdown-content h3,
    .markdown-content h4,
    .markdown-content h5,
    .markdown-content h6 {
      margin-top: 24px;
      margin-bottom: 16px;
      font-weight: 600;
      line-height: 1.25;
    }
    
    .markdown-content p {
      margin-bottom: 16px;
    }
    
    .markdown-content pre {
      background-color: hsl(210 40% 96.1%);
      border-radius: 6px;
      padding: 16px;
      overflow-x: auto;
      font-family: 'Courier New', monospace;
      font-size: 14px;
    }
    
    .markdown-content code {
      background-color: hsl(210 40% 96.1%);
      padding: 2px 4px;
      border-radius: 3px;
      font-family: 'Courier New', monospace;
      font-size: 14px;
    }
    
    /* Estilos para componentes React renderizados */
    .react-component {
      width: 100%;
      height: 100%;
      padding: 16px;
    }
    
    /* Estilos para botones (compatibles con el proyecto) */
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 500;
      transition: all 0.2s;
      cursor: pointer;
      border: 1px solid transparent;
      padding: 8px 16px;
    }
    
    .btn-primary {
      background-color: hsl(220 85% 47%);
      color: hsl(0 0% 100%);
    }
    
    .btn-primary:hover {
      background-color: hsl(220 85% 42%);
    }
    
    .btn-secondary {
      background-color: hsl(220 14% 35%);
      color: hsl(0 0% 100%);
    }
    
    .btn-secondary:hover {
      background-color: hsl(220 14% 30%);
    }
  </style>
</head>
<body>
  <div id="root">
    <div class="loading">Inicializando renderizador...</div>
  </div>

  <script>
    // Verificar carga de Recharts
    window.addEventListener('load', function() {
      console.log('Verificando Recharts...');
      console.log('window.Recharts:', window.Recharts);
      
      if (window.Recharts) {
        console.log('Recharts cargado exitosamente');
        console.log('Componentes disponibles:', Object.keys(window.Recharts));
      } else {
        console.error('ERROR: Recharts no se carg√≥ correctamente');
      }
    });

    // Definir Ship como componente React v√°lido para evitar errores
    window.Ship = function Ship(props) {
      const { x = 0, y = 0, width = 50, height = 30, color = '#4A90E2' } = props || {};
      
      return React.createElement('div', {
        style: {
          position: 'absolute',
          left: x + 'px',
          top: y + 'px',
          width: width + 'px',
          height: height + 'px',
          backgroundColor: color,
          borderRadius: '4px',
          display: 'flex',
          alignItems: 'center',
          justifyContent: 'center',
          fontSize: '12px',
          color: 'white',
          fontWeight: 'bold'
        }
      }, 'üö¢');
    };

    // Tambi√©n definir como clase para compatibilidad con c√≥digo no-React
    window.ShipClass = class ShipClass {
      constructor(options = {}) {
        this.x = options.x || 0;
        this.y = options.y || 0;
        this.width = options.width || 50;
        this.height = options.height || 30;
        this.color = options.color || '#4A90E2';
        this.speed = options.speed || 2;
        this.direction = options.direction || 0;
      }

      update() {
        this.x += Math.cos(this.direction) * this.speed;
        this.y += Math.sin(this.direction) * this.speed;
      }

      render(ctx) {
        if (ctx && typeof ctx.fillRect === 'function') {
          ctx.fillStyle = this.color;
          ctx.fillRect(this.x, this.y, this.width, this.height);
        }
      }

      setPosition(x, y) {
        this.x = x;
        this.y = y;
      }

      setDirection(direction) {
        this.direction = direction;
      }
    };

    console.log('‚úÖ Ship component y ShipClass definidos globalmente');

    // Definir componentes adicionales comunes para evitar errores
    window.Animal = function Animal(props) {
      const { type = 'generic', count = 0, weight = 0, age = 0 } = props || {};
      
      const animalEmojis = {
        chicken: 'üêî',
        cow: 'üêÑ',
        pig: 'üê∑',
        sheep: 'üêë',
        horse: 'üê¥',
        generic: 'üêæ'
      };
      
      return React.createElement('div', {
        style: {
          padding: '10px',
          margin: '5px',
          border: '1px solid #ccc',
          borderRadius: '8px',
          display: 'inline-block',
          textAlign: 'center',
          backgroundColor: '#f8f9fa'
        }
      }, [
        React.createElement('div', { key: 'emoji', style: { fontSize: '24px' } }, animalEmojis[type] || animalEmojis.generic),
        React.createElement('div', { key: 'type', style: { fontWeight: 'bold', marginTop: '5px' } }, type),
        React.createElement('div', { key: 'count', style: { fontSize: '12px' } }, `Cantidad: ${count}`),
        React.createElement('div', { key: 'weight', style: { fontSize: '12px' } }, `Peso: ${weight}kg`),
        React.createElement('div', { key: 'age', style: { fontSize: '12px' } }, `Edad: ${age} d√≠as`)
      ]);
    };

    // Definir Chart como componente gen√©rico
    window.Chart = function Chart(props) {
      const { data = [], type = 'bar', title = 'Gr√°fico' } = props || {};
      
      return React.createElement('div', {
        style: {
          padding: '20px',
          border: '1px solid #ddd',
          borderRadius: '8px',
          backgroundColor: '#fff'
        }
      }, [
        React.createElement('h3', { key: 'title', style: { textAlign: 'center', marginBottom: '20px' } }, title),
        React.createElement('div', { 
          key: 'chart', 
          style: { 
            height: '300px', 
            display: 'flex', 
            alignItems: 'center', 
            justifyContent: 'center',
            backgroundColor: '#f8f9fa',
            border: '2px dashed #ccc'
          } 
        }, `Gr√°fico ${type} - ${data.length} elementos`)
      ]);
    };

    // Definir AnimalChart como componente espec√≠fico
    window.AnimalChart = function AnimalChart(props) {
      const { animals = [], title = 'Animal Chart' } = props || {};
      
      return React.createElement('div', {
        style: {
          padding: '20px',
          fontFamily: 'Arial, sans-serif'
        }
      }, [
        React.createElement('h2', { 
          key: 'title', 
          style: { 
            textAlign: 'center', 
            color: '#2563eb', 
            marginBottom: '20px' 
          } 
        }, title),
        React.createElement('div', {
          key: 'animals',
          style: {
            display: 'grid',
            gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))',
            gap: '15px'
          }
        }, animals.map((animal, index) => 
          React.createElement(window.Animal, { 
            key: index, 
            ...animal 
          })
        ))
      ]);
    };

    // Definir funciones auxiliares comunes
    window.createAnimalData = function(type, count, weight, age) {
      return { type, count, weight, age };
    };

    window.generateSampleAnimals = function() {
      return [
        { type: 'chicken', count: 150, weight: 2.5, age: 45 },
        { type: 'cow', count: 25, weight: 450, age: 365 },
        { type: 'pig', count: 80, weight: 120, age: 180 },
        { type: 'sheep', count: 60, weight: 70, age: 200 }
      ];
    };

    console.log('‚úÖ Componentes adicionales definidos: Animal, Chart, AnimalChart');

    // Definir iconos y componentes faltantes de Recharts
    window.BarChartIcon = function BarChartIcon(props) {
      const { size = 24, color = 'currentColor', ...rest } = props || {};
      return React.createElement('svg', {
        width: size,
        height: size,
        viewBox: '0 0 24 24',
        fill: 'none',
        stroke: color,
        strokeWidth: 2,
        strokeLinecap: 'round',
        strokeLinejoin: 'round',
        ...rest
      }, [
        React.createElement('line', { key: 'line1', x1: '12', y1: '20', x2: '12', y2: '10' }),
        React.createElement('line', { key: 'line2', x1: '18', y1: '20', x2: '18', y2: '4' }),
        React.createElement('line', { key: 'line3', x1: '6', y1: '20', x2: '6', y2: '16' })
      ]);
    };

    window.LineChartIcon = function LineChartIcon(props) {
      const { size = 24, color = 'currentColor', ...rest } = props || {};
      return React.createElement('svg', {
        width: size,
        height: size,
        viewBox: '0 0 24 24',
        fill: 'none',
        stroke: color,
        strokeWidth: 2,
        strokeLinecap: 'round',
        strokeLinejoin: 'round',
        ...rest
      }, [
        React.createElement('polyline', { key: 'polyline', points: '22,6 13,15 8,10 2,16' })
      ]);
    };

    window.PieChartIcon = function PieChartIcon(props) {
      const { size = 24, color = 'currentColor', ...rest } = props || {};
      return React.createElement('svg', {
        width: size,
        height: size,
        viewBox: '0 0 24 24',
        fill: 'none',
        stroke: color,
        strokeWidth: 2,
        strokeLinecap: 'round',
        strokeLinejoin: 'round',
        ...rest
      }, [
        React.createElement('path', { key: 'path1', d: 'M21.21 15.89A10 10 0 1 1 8 2.83' }),
        React.createElement('path', { key: 'path2', d: 'm22 12-10-10v10z' })
      ]);
    };

    // Definir componentes de dashboard comunes
    window.Dashboard = function Dashboard(props) {
      const { title = 'Dashboard', children, ...rest } = props || {};
      return React.createElement('div', {
        style: {
          padding: '20px',
          fontFamily: 'Arial, sans-serif',
          backgroundColor: '#f8f9fa',
          minHeight: '100vh'
        },
        ...rest
      }, [
        React.createElement('h1', { 
          key: 'title',
          style: { 
            textAlign: 'center', 
            color: '#2563eb', 
            marginBottom: '30px',
            fontSize: '28px',
            fontWeight: 'bold'
          } 
        }, title),
        React.createElement('div', { key: 'content' }, children)
      ]);
    };

    window.Card = function Card(props) {
      const { title, children, icon, ...rest } = props || {};
      return React.createElement('div', {
        style: {
          backgroundColor: 'white',
          borderRadius: '8px',
          padding: '20px',
          boxShadow: '0 2px 4px rgba(0,0,0,0.1)',
          border: '1px solid #e5e7eb'
        },
        ...rest
      }, [
        title && React.createElement('div', {
          key: 'header',
          style: {
            display: 'flex',
            alignItems: 'center',
            marginBottom: '15px',
            paddingBottom: '10px',
            borderBottom: '1px solid #e5e7eb'
          }
        }, [
          icon && React.createElement('div', { key: 'icon', style: { marginRight: '10px' } }, icon),
          React.createElement('h3', { 
            key: 'title',
            style: { 
              margin: 0, 
              fontSize: '18px', 
              fontWeight: '600',
              color: '#374151'
            } 
          }, title)
        ]),
        React.createElement('div', { key: 'content' }, children)
      ]);
    };

    // Definir LogisticaDashboard espec√≠ficamente
    window.LogisticaDashboard = function LogisticaDashboard(props) {
      const { data = [], title = 'Dashboard de Log√≠stica' } = props || {};
      
      const sampleData = data.length > 0 ? data : [
        { name: 'Entregas', value: 85, color: '#8884d8' },
        { name: 'En Tr√°nsito', value: 12, color: '#82ca9d' },
        { name: 'Pendientes', value: 3, color: '#ffc658' }
      ];

      return React.createElement(window.Dashboard, { title }, [
        React.createElement('div', {
          key: 'grid',
          style: {
            display: 'grid',
            gridTemplateColumns: 'repeat(auto-fit, minmax(300px, 1fr))',
            gap: '20px',
            marginBottom: '30px'
          }
        }, [
          React.createElement(window.Card, {
            key: 'chart1',
            title: 'Estado de Entregas',
            icon: React.createElement(window.PieChartIcon, { size: 20 })
          }, React.createElement('div', {
            style: {
              height: '200px',
              display: 'flex',
              alignItems: 'center',
              justifyContent: 'center',
              backgroundColor: '#f3f4f6',
              borderRadius: '4px'
            }
          }, 'Gr√°fico de Torta - Estados de Entrega')),
          
          React.createElement(window.Card, {
            key: 'chart2',
            title: 'Tendencia Mensual',
            icon: React.createElement(window.LineChartIcon, { size: 20 })
          }, React.createElement('div', {
            style: {
              height: '200px',
              display: 'flex',
              alignItems: 'center',
              justifyContent: 'center',
              backgroundColor: '#f3f4f6',
              borderRadius: '4px'
            }
          }, 'Gr√°fico de L√≠neas - Tendencia')),
          
          React.createElement(window.Card, {
            key: 'chart3',
            title: 'Volumen por Regi√≥n',
            icon: React.createElement(window.BarChartIcon, { size: 20 })
          }, React.createElement('div', {
            style: {
              height: '200px',
              display: 'flex',
              alignItems: 'center',
              justifyContent: 'center',
              backgroundColor: '#f3f4f6',
              borderRadius: '4px'
            }
          }, 'Gr√°fico de Barras - Regiones'))
        ]),
        
        React.createElement('div', {
          key: 'stats',
          style: {
            display: 'grid',
            gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))',
            gap: '15px'
          }
        }, sampleData.map((item, index) => 
          React.createElement('div', {
            key: index,
            style: {
              backgroundColor: 'white',
              padding: '20px',
              borderRadius: '8px',
              textAlign: 'center',
              boxShadow: '0 2px 4px rgba(0,0,0,0.1)',
              border: `3px solid ${item.color}`
            }
          }, [
            React.createElement('div', {
              key: 'value',
              style: {
                fontSize: '32px',
                fontWeight: 'bold',
                color: item.color,
                marginBottom: '8px'
              }
            }, item.value + '%'),
            React.createElement('div', {
              key: 'name',
              style: {
                fontSize: '14px',
                color: '#6b7280',
                fontWeight: '500'
              }
            }, item.name)
          ])
        ))
      ]);
    };

    console.log('‚úÖ Iconos y componentes de dashboard definidos: BarChartIcon, LineChartIcon, PieChartIcon, Dashboard, Card, LogisticaDashboard');

    // Definir iconos adicionales comunes (Lucide React style)
    window.AlertCircle = function AlertCircle(props) {
      const { size = 24, color = 'currentColor', ...rest } = props || {};
      return React.createElement('svg', {
        width: size,
        height: size,
        viewBox: '0 0 24 24',
        fill: 'none',
        stroke: color,
        strokeWidth: 2,
        strokeLinecap: 'round',
        strokeLinejoin: 'round',
        ...rest
      }, [
        React.createElement('circle', { key: 'circle', cx: '12', cy: '12', r: '10' }),
        React.createElement('line', { key: 'line1', x1: '12', y1: '8', x2: '12', y2: '12' }),
        React.createElement('line', { key: 'line2', x1: '12', y1: '16', x2: '12.01', y2: '16' })
      ]);
    };

    window.CheckCircle = function CheckCircle(props) {
      const { size = 24, color = 'currentColor', ...rest } = props || {};
      return React.createElement('svg', {
        width: size,
        height: size,
        viewBox: '0 0 24 24',
        fill: 'none',
        stroke: color,
        strokeWidth: 2,
        strokeLinecap: 'round',
        strokeLinejoin: 'round',
        ...rest
      }, [
        React.createElement('path', { key: 'path', d: 'm9 12 2 2 4-4' }),
        React.createElement('circle', { key: 'circle', cx: '12', cy: '12', r: '10' })
      ]);
    };

    window.XCircle = function XCircle(props) {
      const { size = 24, color = 'currentColor', ...rest } = props || {};
      return React.createElement('svg', {
        width: size,
        height: size,
        viewBox: '0 0 24 24',
        fill: 'none',
        stroke: color,
        strokeWidth: 2,
        strokeLinecap: 'round',
        strokeLinejoin: 'round',
        ...rest
      }, [
        React.createElement('circle', { key: 'circle', cx: '12', cy: '12', r: '10' }),
        React.createElement('path', { key: 'path', d: 'm15 9-6 6' }),
        React.createElement('path', { key: 'path2', d: 'm9 9 6 6' })
      ]);
    };

    window.InfoIcon = function InfoIcon(props) {
      const { size = 24, color = 'currentColor', ...rest } = props || {};
      return React.createElement('svg', {
        width: size,
        height: size,
        viewBox: '0 0 24 24',
        fill: 'none',
        stroke: color,
        strokeWidth: 2,
        strokeLinecap: 'round',
        strokeLinejoin: 'round',
        ...rest
      }, [
        React.createElement('circle', { key: 'circle', cx: '12', cy: '12', r: '10' }),
        React.createElement('path', { key: 'path1', d: 'l 12,16 12,12' }),
        React.createElement('path', { key: 'path2', d: 'l 12,8 12.01,8' })
      ]);
    };

    window.TrendingUp = function TrendingUp(props) {
      const { size = 24, color = 'currentColor', ...rest } = props || {};
      return React.createElement('svg', {
        width: size,
        height: size,
        viewBox: '0 0 24 24',
        fill: 'none',
        stroke: color,
        strokeWidth: 2,
        strokeLinecap: 'round',
        strokeLinejoin: 'round',
        ...rest
      }, [
        React.createElement('polyline', { key: 'polyline', points: '22,6 13,15 8,10 2,16' }),
        React.createElement('polyline', { key: 'arrow', points: '16,6 22,6 22,12' })
      ]);
    };

    window.TrendingDown = function TrendingDown(props) {
      const { size = 24, color = 'currentColor', ...rest } = props || {};
      return React.createElement('svg', {
        width: size,
        height: size,
        viewBox: '0 0 24 24',
        fill: 'none',
        stroke: color,
        strokeWidth: 2,
        strokeLinecap: 'round',
        strokeLinejoin: 'round',
        ...rest
      }, [
        React.createElement('polyline', { key: 'polyline', points: '22,18 13,9 8,14 2,8' }),
        React.createElement('polyline', { key: 'arrow', points: '16,18 22,18 22,12' })
      ]);
    };

    window.Activity = function Activity(props) {
      const { size = 24, color = 'currentColor', ...rest } = props || {};
      return React.createElement('svg', {
        width: size,
        height: size,
        viewBox: '0 0 24 24',
        fill: 'none',
        stroke: color,
        strokeWidth: 2,
        strokeLinecap: 'round',
        strokeLinejoin: 'round',
        ...rest
      }, [
        React.createElement('polyline', { key: 'polyline', points: '22,12 18,12 15,21 9,3 6,12 2,12' })
      ]);
    };

    window.Users = function Users(props) {
      const { size = 24, color = 'currentColor', ...rest } = props || {};
      return React.createElement('svg', {
        width: size,
        height: size,
        viewBox: '0 0 24 24',
        fill: 'none',
        stroke: color,
        strokeWidth: 2,
        strokeLinecap: 'round',
        strokeLinejoin: 'round',
        ...rest
      }, [
        React.createElement('path', { key: 'path1', d: 'M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2' }),
        React.createElement('circle', { key: 'circle1', cx: '9', cy: '7', r: '4' }),
        React.createElement('path', { key: 'path2', d: 'm22 21v-2a4 4 0 0 0-3-3.87' }),
        React.createElement('path', { key: 'path3', d: 'm16 3.13a4 4 0 0 1 0 7.75' })
      ]);
    };

    window.DollarSign = function DollarSign(props) {
      const { size = 24, color = 'currentColor', ...rest } = props || {};
      return React.createElement('svg', {
        width: size,
        height: size,
        viewBox: '0 0 24 24',
        fill: 'none',
        stroke: color,
        strokeWidth: 2,
        strokeLinecap: 'round',
        strokeLinejoin: 'round',
        ...rest
      }, [
        React.createElement('line', { key: 'line1', x1: '12', y1: '1', x2: '12', y2: '23' }),
        React.createElement('path', { key: 'path', d: 's17 5 0 0c-5 0-9 3-9 9s4 9 9 9 9-3 9-9c0-5-4-9-9-9z' })
      ]);
    };

    window.Calendar = function Calendar(props) {
      const { size = 24, color = 'currentColor', ...rest } = props || {};
      return React.createElement('svg', {
        width: size,
        height: size,
        viewBox: '0 0 24 24',
        fill: 'none',
        stroke: color,
        strokeWidth: 2,
        strokeLinecap: 'round',
        strokeLinejoin: 'round',
        ...rest
      }, [
        React.createElement('rect', { key: 'rect', width: '18', height: '18', x: '3', y: '4', rx: '2', ry: '2' }),
        React.createElement('line', { key: 'line1', x1: '16', y1: '2', x2: '16', y2: '6' }),
        React.createElement('line', { key: 'line2', x1: '8', y1: '2', x2: '8', y2: '6' }),
        React.createElement('line', { key: 'line3', x1: '3', y1: '10', x2: '21', y2: '10' })
      ]);
    };

    // Definir componentes de alerta y notificaci√≥n
    window.Alert = function Alert(props) {
      const { children, variant = 'default', icon, ...rest } = props || {};
      
      const variants = {
        default: { bg: '#f3f4f6', border: '#d1d5db', text: '#374151' },
        destructive: { bg: '#fef2f2', border: '#fecaca', text: '#dc2626' },
        warning: { bg: '#fffbeb', border: '#fed7aa', text: '#d97706' },
        success: { bg: '#f0fdf4', border: '#bbf7d0', text: '#16a34a' }
      };
      
      const style = variants[variant] || variants.default;
      
      return React.createElement('div', {
        style: {
          padding: '12px 16px',
          borderRadius: '6px',
          border: `1px solid ${style.border}`,
          backgroundColor: style.bg,
          color: style.text,
          display: 'flex',
          alignItems: 'flex-start',
          gap: '8px'
        },
        ...rest
      }, [
        icon && React.createElement('div', { key: 'icon', style: { flexShrink: 0, marginTop: '2px' } }, icon),
        React.createElement('div', { key: 'content', style: { flex: 1 } }, children)
      ]);
    };

    console.log('‚úÖ Iconos adicionales definidos: AlertCircle, CheckCircle, XCircle, InfoIcon, TrendingUp, TrendingDown, Activity, Users, DollarSign, Calendar, Alert');

    // Definir Sliders y otros componentes UI faltantes
    window.Sliders = function Sliders(props) {
      const { size = 24, color = 'currentColor', ...rest } = props || {};
      return React.createElement('svg', {
        width: size,
        height: size,
        viewBox: '0 0 24 24',
        fill: 'none',
        stroke: color,
        strokeWidth: 2,
        strokeLinecap: 'round',
        strokeLinejoin: 'round',
        ...rest
      }, [
        React.createElement('line', { key: 'line1', x1: '4', y1: '21', x2: '4', y2: '14' }),
        React.createElement('line', { key: 'line2', x1: '4', y1: '10', x2: '4', y2: '3' }),
        React.createElement('line', { key: 'line3', x1: '12', y1: '21', x2: '12', y2: '12' }),
        React.createElement('line', { key: 'line4', x1: '12', y1: '8', x2: '12', y2: '3' }),
        React.createElement('line', { key: 'line5', x1: '20', y1: '21', x2: '20', y2: '16' }),
        React.createElement('line', { key: 'line6', x1: '20', y1: '12', x2: '20', y2: '3' }),
        React.createElement('line', { key: 'line7', x1: '1', y1: '14', x2: '7', y2: '14' }),
        React.createElement('line', { key: 'line8', x1: '9', y1: '8', x2: '15', y2: '8' }),
        React.createElement('line', { key: 'line9', x1: '17', y1: '16', x2: '23', y2: '16' })
      ]);
    };

    window.Settings = function Settings(props) {
      const { size = 24, color = 'currentColor', ...rest } = props || {};
      return React.createElement('svg', {
        width: size,
        height: size,
        viewBox: '0 0 24 24',
        fill: 'none',
        stroke: color,
        strokeWidth: 2,
        strokeLinecap: 'round',
        strokeLinejoin: 'round',
        ...rest
      }, [
        React.createElement('circle', { key: 'circle', cx: '12', cy: '12', r: '3' }),
        React.createElement('path', { key: 'path', d: 'm12 1 1.27 2.22a8 8 0 0 1 2.56.9l2.22-1.27 1.41 1.41-1.27 2.22a8 8 0 0 1 .9 2.56L21 12l-1.27 1.27a8 8 0 0 1-.9 2.56l1.27 2.22-1.41 1.41-2.22-1.27a8 8 0 0 1-2.56.9L12 23l-1.27-1.27a8 8 0 0 1-2.56-.9l-2.22 1.27-1.41-1.41 1.27-2.22a8 8 0 0 1-.9-2.56L3 12l1.27-1.27a8 8 0 0 1 .9-2.56L3.9 5.95l1.41-1.41 2.22 1.27a8 8 0 0 1 2.56-.9L12 1z' })
      ]);
    };

    console.log('‚úÖ Componentes UI adicionales definidos: Sliders, Settings');

    // Definir Zap y otros iconos comunes faltantes
    window.Zap = function Zap(props) {
      const { size = 24, color = 'currentColor', ...rest } = props || {};
      return React.createElement('svg', {
        width: size,
        height: size,
        viewBox: '0 0 24 24',
        fill: 'none',
        stroke: color,
        strokeWidth: 2,
        strokeLinecap: 'round',
        strokeLinejoin: 'round',
        ...rest
      }, [
        React.createElement('polygon', { key: 'polygon', points: '13,2 3,14 12,14 11,22 21,10 12,10 13,2' })
      ]);
    };

    window.Lightning = window.Zap; // Alias com√∫n

    window.Power = function Power(props) {
      const { size = 24, color = 'currentColor', ...rest } = props || {};
      return React.createElement('svg', {
        width: size,
        height: size,
        viewBox: '0 0 24 24',
        fill: 'none',
        stroke: color,
        strokeWidth: 2,
        strokeLinecap: 'round',
        strokeLinejoin: 'round',
        ...rest
      }, [
        React.createElement('path', { key: 'path', d: 'M18.36 6.64a9 9 0 1 1-12.73 0' }),
        React.createElement('line', { key: 'line', x1: '12', y1: '2', x2: '12', y2: '12' })
      ]);
    };

    window.Wifi = function Wifi(props) {
      const { size = 24, color = 'currentColor', ...rest } = props || {};
      return React.createElement('svg', {
        width: size,
        height: size,
        viewBox: '0 0 24 24',
        fill: 'none',
        stroke: color,
        strokeWidth: 2,
        strokeLinecap: 'round',
        strokeLinejoin: 'round',
        ...rest
      }, [
        React.createElement('path', { key: 'path1', d: 'm1 9 4-4 4 4' }),
        React.createElement('path', { key: 'path2', d: 'm1 9 4-4 4 4' }),
        React.createElement('path', { key: 'path3', d: 'M20 20h.01' }),
        React.createElement('path', { key: 'path4', d: 'M18 18h.01' }),
        React.createElement('path', { key: 'path5', d: 'M16 16h.01' })
      ]);
    };

    window.Battery = function Battery(props) {
      const { size = 24, color = 'currentColor', ...rest } = props || {};
      return React.createElement('svg', {
        width: size,
        height: size,
        viewBox: '0 0 24 24',
        fill: 'none',
        stroke: color,
        strokeWidth: 2,
        strokeLinecap: 'round',
        strokeLinejoin: 'round',
        ...rest
      }, [
        React.createElement('rect', { key: 'rect', width: '16', height: '10', x: '2', y: '7', rx: '2', ry: '2' }),
        React.createElement('line', { key: 'line', x1: '22', y1: '11', x2: '22', y2: '13' })
      ]);
    };

    console.log('‚úÖ Iconos adicionales definidos: Zap, Lightning, Power, Wifi, Battery');

    // Definir iconos de transporte y log√≠stica
    window.Truck = function Truck(props) {
      const { size = 24, color = 'currentColor', ...rest } = props || {};
      return React.createElement('svg', {
        width: size,
        height: size,
        viewBox: '0 0 24 24',
        fill: 'none',
        stroke: color,
        strokeWidth: 2,
        strokeLinecap: 'round',
        strokeLinejoin: 'round',
        ...rest
      }, [
        React.createElement('rect', { key: 'rect1', width: '16', height: '6', x: '1', y: '3', rx: '1' }),
        React.createElement('path', { key: 'path1', d: 'm1 9 4 0' }),
        React.createElement('path', { key: 'path2', d: 'M5 9h3' }),
        React.createElement('path', { key: 'path3', d: 'm18 9 4 0' }),
        React.createElement('path', { key: 'path4', d: 'M2 15h20' }),
        React.createElement('circle', { key: 'circle1', cx: '8', cy: '19', r: '2' }),
        React.createElement('circle', { key: 'circle2', cx: '16', cy: '19', r: '2' })
      ]);
    };

    window.Car = function Car(props) {
      const { size = 24, color = 'currentColor', ...rest } = props || {};
      return React.createElement('svg', {
        width: size,
        height: size,
        viewBox: '0 0 24 24',
        fill: 'none',
        stroke: color,
        strokeWidth: 2,
        strokeLinecap: 'round',
        strokeLinejoin: 'round',
        ...rest
      }, [
        React.createElement('path', { key: 'path1', d: 'M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9L18.4 9.6a2 2 0 0 0-1.3-.6H16' }),
        React.createElement('path', { key: 'path2', d: 'M5 17H3c-.6 0-1-.4-1-1v-3c0-.9.7-1.7 1.5-1.9L5.6 9.6c.4-.4.9-.6 1.3-.6H8' }),
        React.createElement('path', { key: 'path3', d: 'M5 17v6' }),
        React.createElement('path', { key: 'path4', d: 'M19 17v6' }),
        React.createElement('circle', { key: 'circle1', cx: '8', cy: '17', r: '2' }),
        React.createElement('circle', { key: 'circle2', cx: '16', cy: '17', r: '2' })
      ]);
    };

    window.Plane = function Plane(props) {
      const { size = 24, color = 'currentColor', ...rest } = props || {};
      return React.createElement('svg', {
        width: size,
        height: size,
        viewBox: '0 0 24 24',
        fill: 'none',
        stroke: color,
        strokeWidth: 2,
        strokeLinecap: 'round',
        strokeLinejoin: 'round',
        ...rest
      }, [
        React.createElement('path', { key: 'path', d: 'M17.8 19.2 16 11l3.5-3.5C21 6 21.5 4 21 3c-1-.5-3 0-4.5 1.5L13 8 4.8 6.2c-.5-.1-.9.1-1.1.5l-.3.5c-.2.5-.1 1 .3 1.3L9 12l-2 3H4l-1 1 3 2 2 3 1-1v-3l3-2 3.5 5.3c.3.4.8.5 1.3.3l.5-.2c.4-.3.6-.7.5-1.2z' })
      ]);
    };

    window.Train = function Train(props) {
      const { size = 24, color = 'currentColor', ...rest } = props || {};
      return React.createElement('svg', {
        width: size,
        height: size,
        viewBox: '0 0 24 24',
        fill: 'none',
        stroke: color,
        strokeWidth: 2,
        strokeLinecap: 'round',
        strokeLinejoin: 'round',
        ...rest
      }, [
        React.createElement('rect', { key: 'rect', width: '16', height: '6', x: '4', y: '3', rx: '2' }),
        React.createElement('path', { key: 'path1', d: 'M4 11h16' }),
        React.createElement('path', { key: 'path2', d: 'M12 3v8' }),
        React.createElement('circle', { key: 'circle1', cx: '8', cy: '15', r: '2' }),
        React.createElement('circle', { key: 'circle2', cx: '16', cy: '15', r: '2' }),
        React.createElement('path', { key: 'path3', d: 'M8 15h8' }),
        React.createElement('path', { key: 'path4', d: 'M4 15h2' }),
        React.createElement('path', { key: 'path5', d: 'M18 15h2' })
      ]);
    };

    window.Package = function Package(props) {
      const { size = 24, color = 'currentColor', ...rest } = props || {};
      return React.createElement('svg', {
        width: size,
        height: size,
        viewBox: '0 0 24 24',
        fill: 'none',
        stroke: color,
        strokeWidth: 2,
        strokeLinecap: 'round',
        strokeLinejoin: 'round',
        ...rest
      }, [
        React.createElement('path', { key: 'path1', d: 'm7.5 4.27 9 5.15' }),
        React.createElement('path', { key: 'path2', d: 'M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z' }),
        React.createElement('path', { key: 'path3', d: 'm3.3 7 8.7 5 8.7-5' }),
        React.createElement('path', { key: 'path4', d: 'M12 22V12' })
      ]);
    };

    window.MapPin = function MapPin(props) {
      const { size = 24, color = 'currentColor', ...rest } = props || {};
      return React.createElement('svg', {
        width: size,
        height: size,
        viewBox: '0 0 24 24',
        fill: 'none',
        stroke: color,
        strokeWidth: 2,
        strokeLinecap: 'round',
        strokeLinejoin: 'round',
        ...rest
      }, [
        React.createElement('path', { key: 'path', d: 'M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z' }),
        React.createElement('circle', { key: 'circle', cx: '12', cy: '10', r: '3' })
      ]);
    };

    window.Navigation = function Navigation(props) {
      const { size = 24, color = 'currentColor', ...rest } = props || {};
      return React.createElement('svg', {
        width: size,
        height: size,
        viewBox: '0 0 24 24',
        fill: 'none',
        stroke: color,
        strokeWidth: 2,
        strokeLinecap: 'round',
        strokeLinejoin: 'round',
        ...rest
      }, [
        React.createElement('polygon', { key: 'polygon', points: '3,11 22,2 13,21 11,13 3,11' })
      ]);
    };

    console.log('‚úÖ Iconos de transporte definidos: Truck, Car, Plane, Train, Package, MapPin, Navigation');

    // Definir AlertTriangle y otros iconos de alerta faltantes
    window.AlertTriangle = function AlertTriangle(props) {
      const { size = 24, color = 'currentColor', ...rest } = props || {};
      return React.createElement('svg', {
        width: size,
        height: size,
        viewBox: '0 0 24 24',
        fill: 'none',
        stroke: color,
        strokeWidth: 2,
        strokeLinecap: 'round',
        strokeLinejoin: 'round',
        ...rest
      }, [
        React.createElement('path', { key: 'path', d: 'm21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z' }),
        React.createElement('path', { key: 'path2', d: 'M12 9v4' }),
        React.createElement('path', { key: 'path3', d: 'M12 17h.01' })
      ]);
    };

    window.AlertOctagon = function AlertOctagon(props) {
      const { size = 24, color = 'currentColor', ...rest } = props || {};
      return React.createElement('svg', {
        width: size,
        height: size,
        viewBox: '0 0 24 24',
        fill: 'none',
        stroke: color,
        strokeWidth: 2,
        strokeLinecap: 'round',
        strokeLinejoin: 'round',
        ...rest
      }, [
        React.createElement('polygon', { key: 'polygon', points: '7.86,2 16.14,2 22,7.86 22,16.14 16.14,22 7.86,22 2,16.14 2,7.86 7.86,2' }),
        React.createElement('line', { key: 'line1', x1: '12', y1: '8', x2: '12', y2: '12' }),
        React.createElement('line', { key: 'line2', x1: '12', y1: '16', x2: '12.01', y2: '16' })
      ]);
    };

    window.Shield = function Shield(props) {
      const { size = 24, color = 'currentColor', ...rest } = props || {};
      return React.createElement('svg', {
        width: size,
        height: size,
        viewBox: '0 0 24 24',
        fill: 'none',
        stroke: color,
        strokeWidth: 2,
        strokeLinecap: 'round',
        strokeLinejoin: 'round',
        ...rest
      }, [
        React.createElement('path', { key: 'path', d: 'M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z' })
      ]);
    };

    window.ShieldAlert = function ShieldAlert(props) {
      const { size = 24, color = 'currentColor', ...rest } = props || {};
      return React.createElement('svg', {
        width: size,
        height: size,
        viewBox: '0 0 24 24',
        fill: 'none',
        stroke: color,
        strokeWidth: 2,
        strokeLinecap: 'round',
        strokeLinejoin: 'round',
        ...rest
      }, [
        React.createElement('path', { key: 'path1', d: 'M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z' }),
        React.createElement('path', { key: 'path2', d: 'M12 8v4' }),
        React.createElement('path', { key: 'path3', d: 'M12 16h.01' })
      ]);
    };

    window.Warning = window.AlertTriangle; // Alias com√∫n

    console.log('‚úÖ Iconos de alerta adicionales definidos: AlertTriangle, AlertOctagon, Shield, ShieldAlert, Warning');
  </script>

  <script>
    /**
     * Convierte datos JSON a componentes React funcionales
     */
    function convertJSONToReactComponent(jsonData, artifactName) {
      try {
        const data = JSON.parse(jsonData);
        
        // Convertir KPIs
        if (artifactName.toLowerCase().includes('kpi')) {
          return generateKPIComponent(data);
        }
        
        // Convertir Sector
        if (artifactName.toLowerCase().includes('sector')) {
          return generateSectorComponent(data);
        }
        
        // Fallback gen√©rico
        return generateGenericComponent(data, artifactName);
        
      } catch (error) {
        console.error('Error convirtiendo JSON:', error);
        return null;
      }
    }

    function generateKPIComponent(data) {
      return `
function KPIComponent() {
  const kpiData = ${JSON.stringify(data)};
  
  // Generar datos para gr√°fico de barras basado en KPIs
  const chartData = kpiData.map((kpi, index) => {
    const baseValue = Math.floor(Math.random() * 100) + 50;
    return {
      name: kpi.type.replace('KPI', ''),
      actual: baseValue,
      meta: baseValue + Math.floor(Math.random() * 30) + 10,
      eficiencia: Math.floor((baseValue / (baseValue + 20)) * 100)
    };
  });

  return (
    <div style={{ padding: '20px', fontFamily: 'Arial' }}>
      <h2 style={{ color: '#2563eb', marginBottom: '20px', textAlign: 'center' }}>
        KPIs Dashboard
      </h2>
      
      {/* Gr√°fico de barras */}
      <div style={{ width: '100%', height: '300px', marginBottom: '30px' }}>
        <h3 style={{ textAlign: 'center', marginBottom: '20px' }}>
          Actual vs Meta
        </h3>
        <ResponsiveContainer width="100%" height="100%">
          <BarChart data={chartData}>
            <CartesianGrid strokeDasharray="3 3" />
            <XAxis dataKey="name" />
            <YAxis />
            <Tooltip />
            <Legend />
            <Bar dataKey="actual" fill="#8884d8" name="Actual" />
            <Bar dataKey="meta" fill="#82ca9d" name="Meta" />
          </BarChart>
        </ResponsiveContainer>
      </div>

      {/* Tarjetas de KPIs */}
      <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(250px, 1fr))', gap: '20px' }}>
        {kpiData.map((kpi, index) => (
          <div key={index} style={{
            padding: '20px',
            border: '2px solid #3b82f6',
            borderRadius: '12px',
            backgroundColor: '#eff6ff',
            textAlign: 'center'
          }}>
            <h3 style={{ margin: '0 0 12px 0', color: '#1e40af' }}>
              {kpi.type.replace('KPI', '')}
            </h3>
            <div style={{ fontSize: '24px', fontWeight: 'bold', color: '#059669', margin: '10px 0' }}>
              {chartData[index].eficiencia}%
            </div>
            <div style={{ fontSize: '12px', color: '#6b7280' }}>
              Eficiencia
            </div>
            <div style={{ marginTop: '12px', fontSize: '14px', color: '#374151' }}>
              {kpi.properties.map((prop, i) => (
                <div key={i} style={{ margin: '4px 0' }}>‚Ä¢ {prop}</div>
              ))}
            </div>
          </div>
        ))}
      </div>
    </div>
  );
}
export default KPIComponent;
      `;
    }

    function generateSectorComponent(data) {
      return `
function SectorComponent() {
  const sectorData = ${JSON.stringify(data)};
  
  // Convertir array de sectores a datos para gr√°fico de torta
  const chartData = sectorData.map((sector, index) => ({
    name: sector,
    value: Math.floor(Math.random() * 100) + 20, // Datos simulados
    fill: ['#8884d8', '#82ca9d', '#ffc658', '#ff7300', '#0088fe'][index % 5]
  }));

  return (
    <div style={{ padding: '20px', fontFamily: 'Arial' }}>
      <h2 style={{ color: '#059669', marginBottom: '20px', textAlign: 'center' }}>
        Distribuci√≥n por Sectores
      </h2>
      <div style={{ width: '100%', height: '400px' }}>
        <ResponsiveContainer width="100%" height="100%">
          <PieChart>
            <Pie
              data={chartData}
              cx="50%"
              cy="50%"
              innerRadius={60}
              outerRadius={120}
              paddingAngle={5}
              dataKey="value"
            >
              {chartData.map((entry, index) => (
                <Cell key={\`cell-\${index}\`} fill={entry.fill} />
              ))}
            </Pie>
            <Tooltip />
            <Legend />
          </PieChart>
        </ResponsiveContainer>
      </div>
      <div style={{ marginTop: '20px', textAlign: 'center' }}>
        <h3>Sectores:</h3>
        <div style={{ display: 'flex', justifyContent: 'center', gap: '20px', flexWrap: 'wrap' }}>
          {sectorData.map((sector, index) => (
            <span key={index} style={{
              padding: '8px 16px',
              backgroundColor: chartData[index].fill,
              color: 'white',
              borderRadius: '20px',
              fontWeight: 'bold'
            }}>
              {sector}
            </span>
          ))}
        </div>
      </div>
    </div>
  );
}
export default SectorComponent;
      `;
    }

    function generateGenericComponent(data, name) {
      return `
function GenericComponent() {
  const jsonData = ${JSON.stringify(data, null, 2)};
  
  return (
    <div style={{ padding: '20px', fontFamily: 'monospace' }}>
      <h2>${name}</h2>
      <pre style={{ 
        background: '#f3f4f6', 
        padding: '16px', 
        borderRadius: '8px',
        overflow: 'auto'
      }}>
        {JSON.stringify(jsonData, null, 2)}
      </pre>
    </div>
  );
}
export default GenericComponent;
      `;
    }

    /**
     * RendererFrame - Renderizador de artefactos optimizado
     * Compatible con React 18, Tailwind CSS y el sistema del proyecto
     */
    class RendererFrame {
      constructor() {
        this.root = document.getElementById('root');
        this.reactRoot = null;
        this.currentType = null;
        this.scriptsLoaded = false;
        this.checkScriptsAndInitialize();
      }

      /**
       * Verifica que todas las librer√≠as est√©n disponibles
       */
      checkLibraries() {
        const missing = [];
        if (typeof React === 'undefined') missing.push('React');
        if (typeof ReactDOM === 'undefined') missing.push('ReactDOM');  
        if (typeof Babel === 'undefined') missing.push('Babel');
        
        // Recharts es opcional - no bloquear si no est√° disponible
        const rechartsAvailable = typeof Recharts !== 'undefined' || typeof window.Recharts !== 'undefined';
        
        if (missing.length > 0) {
          const error = 'Missing critical libraries: ' + missing.join(', ');
          console.error(error);
          parent.postMessage({ type: 'DEPENDENCY_ERROR', error }, '*');
          return false;
        }
        
        console.log('Librer√≠as verificadas:', {
          React: !!window.React,
          ReactDOM: !!window.ReactDOM,
          Babel: !!window.Babel,
          Recharts: rechartsAvailable,
          'Recharts (window)': !!window.Recharts,
          'Recharts (global)': typeof Recharts !== 'undefined'
        });
        
        if (!rechartsAvailable) {
          console.warn('Recharts no disponible - se usar√°n fallbacks para gr√°ficos');
        }
        
        return true;
      }

      /**
       * Verifica que todos los scripts est√©n cargados antes de inicializar
       */
      checkScriptsAndInitialize() {
        const checkInterval = setInterval(() => {
          // Verificar scripts esenciales primero
          if (window.React && window.ReactDOM && window.Babel && window.tailwind) {
            clearInterval(checkInterval);
            
            // Verificar librer√≠as con la nueva funci√≥n
            if (!this.checkLibraries()) {
              return; // Si faltan librer√≠as, no continuar
            }
            
            this.scriptsLoaded = true;
            console.log('Scripts esenciales cargados:', {
              React: !!window.React,
              ReactDOM: !!window.ReactDOM,
              Babel: !!window.Babel,
              Tailwind: !!window.tailwind,
              Recharts: !!window.Recharts,
              PropTypes: !!window.PropTypes
            });
            this.setupReactRoot();
            this.setupMessageHandling();
            this.setupErrorHandling();
            this.notifyReady();
          }
        }, 100);

        // Timeout despu√©s de 10 segundos
        setTimeout(() => {
          if (!this.scriptsLoaded) {
            clearInterval(checkInterval);
            console.error('Scripts no cargados:', {
              React: !!window.React,
              ReactDOM: !!window.ReactDOM,
              Babel: !!window.Babel,
              Tailwind: !!window.tailwind,
              Recharts: !!window.Recharts,
              PropTypes: !!window.PropTypes
            });
            this.notifyError('Error cargando scripts externos. Verifique la conexi√≥n a internet.');
          }
        }, 10000);
      }

      /**
       * Configura React 18 Root
       */
      setupReactRoot() {
        try {
          if (window.ReactDOM && window.ReactDOM.createRoot) {
            this.reactRoot = ReactDOM.createRoot(this.root);
          } else {
            console.warn('React 18 createRoot no disponible, usando render legacy');
          }
        } catch (error) {
          console.error('Error configurando React Root:', error);
        }
      }

      /**
       * Configura manejo de mensajes
       */
      setupMessageHandling() {
        window.addEventListener('message', (event) => {
          try {
            if (event.data.type === 'RENDER_ARTIFACT') {
              this.renderContent(event.data.payload);
            } else if (event.data.type === 'CLEAR_CONTENT') {
              this.clearContent();
            }
          } catch (error) {
            this.notifyError(`Error procesando mensaje: ${error.message}`);
          }
        });
      }

      /**
       * Configura manejo global de errores
       */
      setupErrorHandling() {
        window.addEventListener('error', (event) => {
          console.error('Error global capturado:', event);
          const errorMessage = event.error?.message || event.message || 'Error desconocido';
          const errorStack = event.error?.stack || '';
          const filename = event.filename || '';
          
          // Filtrar errores comunes de librer√≠as externas que no afectan la funcionalidad
          if (errorMessage.includes('Cannot read properties of undefined') && 
              (errorStack.includes('Animate.js') || errorStack.includes('FunnelChart'))) {
            console.warn('Error de animaci√≥n/gr√°fico ignorado:', errorMessage);
            return; // No notificar estos errores espec√≠ficos
          }
          
          // Filtrar errores de scripts externos (CORS)
          if (errorMessage === 'Script error.' && !filename) {
            console.warn('Error de script externo ignorado (posible CORS)');
            return;
          }
          
          // Filtrar errores de extensiones del navegador
          if (filename && (filename.includes('extension://') || filename.includes('chrome-extension://'))) {
            console.warn('Error de extensi√≥n del navegador ignorado:', filename);
            return;
          }
          
          this.notifyError(`Error global: ${errorMessage}`);
        });

        window.addEventListener('unhandledrejection', (event) => {
          console.error('Promise rechazada capturada:', event);
          const reason = event.reason?.message || event.reason || 'Promise rechazada';
          
          // Filtrar errores de animaciones que no afectan la funcionalidad
          if (typeof reason === 'string' && reason.includes('Cannot read properties of undefined')) {
            console.warn('Error de promise ignorado:', reason);
            return;
          }
          
          // Filtrar errores de red comunes
          if (typeof reason === 'string' && (reason.includes('NetworkError') || reason.includes('fetch'))) {
            console.warn('Error de red ignorado:', reason);
            return;
          }
          
          this.notifyError(`Promise rechazada: ${reason}`);
        });
        
        // Capturar errores de React espec√≠ficamente
        window.addEventListener('unhandledrejection', (event) => {
          if (event.reason && event.reason.toString().includes('React')) {
            console.warn('Error de React capturado y manejado:', event.reason);
            event.preventDefault(); // Prevenir que se propague
          }
        });
      }

      /**
       * Renderiza contenido seg√∫n el tipo
       */
      async renderContent({ code, type, artifactId }) {
        console.log('=== DEBUG RENDERIZADO ===');
        console.log('Artifact ID:', artifactId);
        console.log('Tipo recibido:', type);
        console.log('C√≥digo recibido:', code.substring(0, 200));
        
        try {
          let processedCode = code;
          let isJSONContent = false;
          
          // TEST DE DETECCI√ìN JSON
          try {
            const parsed = JSON.parse(code.trim());
            isJSONContent = true;
            console.log('‚úÖ JSON DETECTADO CORRECTAMENTE');
            console.log('Datos parseados:', parsed);
          } catch (e) {
            console.log('‚ùå NO ES JSON:', e.message);
          }
          
          if (isJSONContent) {
            console.log('üîÑ INICIANDO CONVERSI√ìN A REACT...');
            const artifactName = artifactId || 'Generic';
            console.log('Nombre del artefacto:', artifactName);
            
            // VERIFICAR QUE LA FUNCI√ìN EXISTE
            if (typeof convertJSONToReactComponent === 'function') {
              console.log('‚úÖ Funci√≥n convertJSONToReactComponent encontrada');
              const convertedCode = convertJSONToReactComponent(code, artifactName);
              console.log('C√≥digo convertido:', convertedCode ? convertedCode.substring(0, 300) : 'NULL');
              
              if (convertedCode) {
                processedCode = convertedCode;
                type = 'react';
                console.log('üéØ CONVERSI√ìN EXITOSA - RENDERIZANDO COMO REACT');
              }
            } else {
              console.error('‚ùå FUNCI√ìN convertJSONToReactComponent NO ENCONTRADA');
            }
          }
          
          this.currentType = type;
          
          // Continuar con renderizado...
          switch (type) {
            case 'react':
              console.log('Renderizando como React...');
              await this.renderReact(processedCode);
              break;
            case 'html':
              this.renderHtml(processedCode);
              break;
            case 'markdown':
              this.renderMarkdown(processedCode);
              break;
            case 'python':
              this.renderPython(processedCode);
              break;
            default:
              console.log('Renderizando como fallback...');
              await this.renderReact(processedCode);
          }
          
          this.notifyComplete(artifactId);
        } catch (error) {
          console.error('ERROR COMPLETO:', error);
          this.showError('Error de renderizado', error.message);
          this.notifyError(error.message, artifactId);
        }
      }

      /**
       * Renderiza componente React
       */
      renderReact(code) {
        try {
          // Detectar si el c√≥digo es JSON y convertirlo a React
          let processedCode = code;
          
          // Intentar detectar y convertir JSON a componente React
          if (this.isValidJSON(code.trim())) {
            console.log('üîÑ Detectado contenido JSON, convirtiendo a componente React...');
            const convertedCode = convertJSONToReactComponent(code.trim(), 'Artifact');
            if (convertedCode) {
              console.log('‚úÖ JSON convertido exitosamente a componente React');
              processedCode = convertedCode;
            } else {
              console.warn('‚ö†Ô∏è No se pudo convertir JSON, usando c√≥digo original');
            }
          }
          
          // Remover declaraciones import que no son compatibles con el entorno del navegador
          processedCode = this.processImports(processedCode);
          
          // Si no tiene export default, agregarlo
          if (!processedCode.includes('export default') && !processedCode.includes('export {')) {
            // Buscar el √∫ltimo componente definido
            const componentMatch = processedCode.match(/(?:function|const|class)\s+([A-Z][a-zA-Z0-9]*)/g);
            if (componentMatch) {
              const lastComponent = componentMatch[componentMatch.length - 1].split(/\s+/)[1];
              processedCode += `\nexport default ${lastComponent};`;
            }
          }

          // Transpilaci√≥n con Babel
          const transformedCode = Babel.transform(processedCode, {
            presets: ['react'],
            plugins: []
          }).code;

          // Preparar el c√≥digo sin export statements para evitar errores de sintaxis
          let executableCode = transformedCode;
          
          // Remover export statements para la ejecuci√≥n
          executableCode = executableCode.replace(/export\s+default\s+/g, '');
          executableCode = executableCode.replace(/export\s+\{[^}]*\}/g, '');
          
          // Buscar el nombre del componente principal
          const componentMatches = executableCode.match(/(?:function|const|class)\s+([A-Z][a-zA-Z0-9]*)/g);
          let componentName = 'App';
          
          if (componentMatches && componentMatches.length > 0) {
            const lastMatch = componentMatches[componentMatches.length - 1];
            componentName = lastMatch.split(/\s+/)[1];
          }
          
          // Crear funci√≥n que retorna el componente con manejo robusto de errores
          let componentFunction;
          try {
            componentFunction = new Function(
              'React', 'ReactDOM', 'Recharts', 'PropTypes',
              `
              try {
                const { useState, useEffect, useCallback, useMemo, useRef } = React || {};
                const { createRoot } = ReactDOM || {};
                
                // Verificaci√≥n antes de renderizar - m√°s permisiva
                if (!window.Recharts) {
                  console.warn('Recharts no est√° disponible, usando fallbacks');
                  throw new Error('Usar fallbacks para Recharts');
                }
                
                // Destructuraci√≥n completa de componentes Recharts
                const { 
                  BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, Legend, 
                  ResponsiveContainer, LineChart, Line, AreaChart, Area, 
                  PieChart, Pie, Cell, ComposedChart, Scatter, ScatterChart,
                  RadarChart, Radar, PolarGrid, PolarAngleAxis, PolarRadiusAxis,
                  Treemap, FunnelChart, Funnel, LabelList
                } = window.Recharts || {};
                
                try {
                  // Debug detallado de Recharts
                  console.log('=== DEBUG RECHARTS ===');
                  console.log('window.Recharts:', window.Recharts);
                  console.log('Recharts keys:', Object.keys(window.Recharts));
                  
                  // Verificar que los componentes principales est√©n disponibles
                  const availableComponents = {
                    BarChart: !!BarChart,
                    Bar: !!Bar,
                    XAxis: !!XAxis,
                    YAxis: !!YAxis,
                    ResponsiveContainer: !!ResponsiveContainer,
                    CartesianGrid: !!CartesianGrid,
                    Tooltip: !!Tooltip,
                    Legend: !!Legend,
                    LineChart: !!LineChart,
                    Line: !!Line,
                    AreaChart: !!AreaChart,
                    Area: !!Area,
                    PieChart: !!PieChart,
                    Pie: !!Pie,
                    Cell: !!Cell
                  };
                  
                  console.log('Estado de componentes Recharts:', availableComponents);
                  console.log('BarChart type:', typeof BarChart);
                  console.log('BarChart:', BarChart);
                  
                  // Verificar que al menos los componentes b√°sicos est√©n disponibles
                  if (!BarChart || !XAxis || !YAxis || !ResponsiveContainer) {
                    console.warn('Componentes b√°sicos de Recharts no disponibles, usando fallbacks');
                    throw new Error('Usar fallbacks para Recharts');
                  }
                  
                  console.log('‚úÖ Recharts disponible, usando componentes reales');
                } catch (error) {
                  console.info('Recharts no disponible, activando sistema de fallbacks (comportamiento normal)');
                  // Crear componentes fallback que muestran mensaje informativo
                  const FallbackComponent = function(props) {
                    return React.createElement('div', { 
                      style: { 
                        padding: '20px', 
                        border: '2px dashed #ccc', 
                        textAlign: 'center',
                        borderRadius: '8px',
                        backgroundColor: '#f9f9f9',
                        margin: '10px 0'
                      } 
                    }, 
                      React.createElement('p', { style: { margin: '0 0 10px 0', fontWeight: 'bold' } }, 'Gr√°fico no disponible'),
                      React.createElement('p', { style: { margin: '0', fontSize: '14px', color: '#666' } }, 'Los gr√°ficos se mostrar√°n como placeholders')
                    );
                  };
                  
                  LineChart = BarChart = PieChart = Line = Bar = Pie = XAxis = YAxis = CartesianGrid = Tooltip = Legend = ResponsiveContainer = FallbackComponent;
                }
                
                ${executableCode}
                
                // Retornar el componente encontrado
                if (typeof ${componentName} !== 'undefined') {
                  return ${componentName};
                }
                
                // Fallback: crear un componente simple
                return function DefaultComponent() {
                  return React.createElement('div', { className: 'p-4' }, 
                    React.createElement('p', null, 'Componente renderizado exitosamente')
                  );
                };
              } catch (vmError) {
                console.error('Error en VM:', vmError);
                return function ErrorComponent() {
                  return React.createElement('div', { className: 'p-4 text-red-500' }, 
                    React.createElement('p', null, 'Error en el componente: ' + vmError.message)
                  );
                };
              }
              `
            );
          } catch (functionError) {
            console.error('Error creando funci√≥n:', functionError);
            throw new Error('Error en la creaci√≥n de la funci√≥n del componente: ' + functionError.message);
          }

          let Component;
          try {
            Component = componentFunction(
              window.React,
              window.ReactDOM,
              window.Recharts || {},
              window.PropTypes || {}
            );
          } catch (executionError) {
            console.error('Error ejecutando funci√≥n:', executionError);
            // Crear componente de error como fallback
            Component = function ErrorComponent() {
              return React.createElement('div', { className: 'p-4 text-red-500' }, 
                React.createElement('p', null, 'Error ejecutando componente: ' + executionError.message)
              );
            };
          }

          // Renderizar con React 18
          if (this.reactRoot) {
            this.reactRoot.render(
              React.createElement('div', { className: 'react-component' },
                React.createElement(Component)
              )
            );
          } else {
            // Fallback para versiones anteriores
            ReactDOM.render(
              React.createElement('div', { className: 'react-component' },
                React.createElement(Component)
              ),
              this.root
            );
          }

        } catch (error) {
          throw new Error(`Error en renderizado React: ${error.message}`);
        }
      }

      /**
       * Renderiza HTML puro
       */
      renderHtml(code) {
        try {
          // Limpiar y sanitizar HTML b√°sico
          const sanitizedCode = code
            .replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi, '')
            .replace(/on\w+="[^"]*"/gi, '');

          this.root.innerHTML = sanitizedCode;
        } catch (error) {
          throw new Error(`Error en renderizado HTML: ${error.message}`);
        }
      }

      /**
       * Renderiza Markdown
       */
      renderMarkdown(code) {
        try {
          if (window.ReactMarkdown) {
            // Usar react-markdown si est√° disponible
            if (this.reactRoot) {
              this.reactRoot.render(
                React.createElement('div', { className: 'markdown-content' },
                  React.createElement(ReactMarkdown, { children: code })
                )
              );
            }
          } else {
            // Fallback simple para Markdown
            const htmlContent = code
              .replace(/^### (.*$)/gim, '<h3>$1</h3>')
              .replace(/^## (.*$)/gim, '<h2>$1</h2>')
              .replace(/^# (.*$)/gim, '<h1>$1</h1>')
              .replace(/\*\*(.*)\*\*/gim, '<strong>$1</strong>')
              .replace(/\*(.*)\*/gim, '<em>$1</em>')
              .replace(/```([\s\S]*?)```/gim, '<pre><code>$1</code></pre>')
              .replace(/`(.*?)`/gim, '<code>$1</code>')
              .replace(/\n/gim, '<br>');

            this.root.innerHTML = `<div class="markdown-content">${htmlContent}</div>`;
          }
        } catch (error) {
          throw new Error(`Error en renderizado Markdown: ${error.message}`);
        }
      }

      /**
       * Renderiza c√≥digo Python (solo visualizaci√≥n)
       */
      renderPython(code) {
        try {
          this.root.innerHTML = `
            <div class="markdown-content">
              <h3>C√≥digo Python</h3>
              <pre><code class="language-python">${this.escapeHtml(code)}</code></pre>
              <p><em>Nota: La ejecuci√≥n de Python no est√° soportada en este entorno.</em></p>
            </div>
          `;
        } catch (error) {
          throw new Error(`Error mostrando c√≥digo Python: ${error.message}`);
        }
      }

      /**
       * Limpia el contenido
       */
      clearContent() {
        try {
          if (this.reactRoot) {
            this.reactRoot.unmount();
            this.setupReactRoot();
          } else {
            this.root.innerHTML = '<div class="loading">Listo para renderizar...</div>';
          }
        } catch (error) {
          console.warn('Error limpiando contenido:', error);
        }
      }

      /**
       * Procesa y remueve declaraciones import incompatibles
       */
      processImports(code) {
        let processedCode = code;
        
        // Remover imports de React (ya disponible globalmente)
        processedCode = processedCode.replace(/import\s+React(?:\s*,\s*\{[^}]*\})?\s+from\s+['"]react['"];?\s*/g, '');
        processedCode = processedCode.replace(/import\s+\{[^}]*\}\s+from\s+['"]react['"];?\s*/g, '');
        
        // Remover imports de React DOM
        processedCode = processedCode.replace(/import\s+.*\s+from\s+['"]react-dom['"];?\s*/g, '');
        
        // Remover imports de librer√≠as de gr√°ficos (Recharts ya disponible)
        processedCode = processedCode.replace(/import\s+.*\s+from\s+['"]recharts['"];?\s*/g, '');
        
        // Remover imports de CSS/estilos
        processedCode = processedCode.replace(/import\s+['"][^'"]*\.css['"];?\s*/g, '');
        processedCode = processedCode.replace(/import\s+['"][^'"]*\.scss['"];?\s*/g, '');
        processedCode = processedCode.replace(/import\s+['"][^'"]*\.sass['"];?\s*/g, '');
        
        // Remover imports de m√≥dulos comunes que no est√°n disponibles
        processedCode = processedCode.replace(/import\s+.*\s+from\s+['"]@\/[^'"]*['"];?\s*/g, '');
        processedCode = processedCode.replace(/import\s+.*\s+from\s+['"]\.\/[^'"]*['"];?\s*/g, '');
        processedCode = processedCode.replace(/import\s+.*\s+from\s+['"]\.\.\/[^'"]*['"];?\s*/g, '');
        
        // Remover imports de librer√≠as externas comunes
        const commonLibraries = [
          'lodash', 'axios', 'moment', 'date-fns', 'uuid', 'classnames', 'clsx',
          'next', 'next/router', 'next/link', 'next/image', 'next/head',
          '@emotion', '@mui', '@chakra-ui', 'antd', 'semantic-ui-react'
        ];
        
        commonLibraries.forEach(lib => {
          const regex = new RegExp(`import\\s+.*\\s+from\\s+['"]${lib}(?:\\/[^'"]*)?['"];?\\s*`, 'g');
          processedCode = processedCode.replace(regex, '');
        });
        
        // Remover cualquier import restante que pueda causar problemas
        processedCode = processedCode.replace(/import\s+.*\s+from\s+['"][^'"]*['"];?\s*/g, '');
        
        // Limpiar l√≠neas vac√≠as m√∫ltiples
        processedCode = processedCode.replace(/\n\s*\n\s*\n/g, '\n\n');
        
        return processedCode.trim();
      }

      /**
       * Verifica si una cadena es JSON v√°lido
       */
      isValidJSON(str) {
        try {
          JSON.parse(str);
          return true;
        } catch (e) {
          return false;
        }
      }

      /**
       * Escapa HTML para prevenir XSS
       */
      escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
      }

      /**
       * Notifica que el frame est√° listo
       */
      notifyReady() {
        parent.postMessage({ 
          type: 'RENDERER_READY',
          timestamp: Date.now()
        }, '*');
      }

      /**
       * Muestra error en el frame
       */
      showError(title, message) {
        this.root.innerHTML = `
          <div class="error-container">
            <strong>${this.escapeHtml(title)}:</strong><br>
            ${this.escapeHtml(message)}
          </div>
        `;
      }

      /**
       * Notifica renderizado completado
       */
      notifyComplete(artifactId) {
        parent.postMessage({ 
          type: 'RENDER_COMPLETE',
          success: true,
          contentType: this.currentType,
          artifactId: artifactId,
          timestamp: Date.now()
        }, '*');
      }

      /**
       * Notifica error
       */
      notifyError(message, artifactId) {
        console.error('Renderer Error:', message);
        
        // Mostrar error en el frame si no se ha mostrado ya
        if (!this.root.innerHTML.includes('error-container')) {
          this.showError('Error de Renderizado', message);
        }

        // Notificar al padre
        parent.postMessage({ 
          type: 'RENDER_ERROR',
          error: message,
          artifactId: artifactId,
          timestamp: Date.now()
        }, '*');
      }
    }

    // Inicializar cuando el DOM est√© listo
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', () => new RendererFrame());
    } else {
      new RendererFrame();
    }
  </script>
</body>
</html>
